# double-books-for-training

**RU:** Инструмент для создания датасетов из параллельных текстов (например, разных переводов одной книги) в формате FB2. Скрипт семантически сопоставляет предложения и формирует JSON-файл для дальнейшего использования, например, для дообучения LLM.

**EN:** A tool for creating datasets from parallel texts (e.g., different translations of the same book) in FB2 format. The script semantically aligns sentences and generates a JSON file suitable for fine-tuning LLMs.

---



# Parallel Text Aligner & Dataset Generator

Этот проект представляет собой мощный инструмент для автоматического создания высококачественных датасетов из параллельных текстовых корпусов. Основная задача — взять два варианта одного и того же произведения (например, два разных перевода книги) в формате `.fb2`, провести глубокий семантический анализ и сопоставить соответствующие друг другу фрагменты текста.

Результатом работы является готовый `.json` файл в формате `instruction-input-output`, идеально подходящий для дообучения (fine-tuning) больших языковых моделей (LLM).

## Основные возможности

*   **Работа с форматом FB2:** Чтение и парсинг популярных файлов электронных книг `.fb2`.
*   **Семантическое сопоставление:** Вместо простого сравнения текста, скрипт использует векторизацию предложений для поиска семантически близких пар, что позволяет успешно работать с разными переводами и редакциями.
*   **Многоэтапный алгоритм:** Процесс выравнивания текстов разбит на несколько этапов для повышения точности:
    1.  Поиск очевидных и почти идентичных совпадений.
    2.  Фильтрация аномалий и устранение пересечений, когда одно предложение ошибочно сопоставляется с несколькими.
    3.  Более сложный поиск для сопоставления предложений, которые были разделены или объединены в разных версиях текста.
*   **Интеллектуальное объединение:** Скрипт умеет группировать короткие предложения (например, диалоги) в осмысленные абзацы и блоки, делая датасет более качественным и контекстно насыщенным.
*   **Генерация датасета для LLM:** Автоматическое формирование и сохранение результата в структурированном JSON-файле, готовом к использованию в фреймворках для обучения моделей.

## Принцип работы

Скрипт выполняет следующие шаги:

1.  **Инициализация:** Очищает рабочие директории и подготавливает среду.
2.  **Чтение данных:** Загружает два файла `.fb2` из указанной папки (`fb2_transformation`).
3.  **Разделение на главы:** Сравнивает структуру книг и обрабатывает их попарно по главам.
4.  **Векторизация:** Каждая глава разбивается на предложения, и для каждого предложения вычисляется его векторное представление (embedding).
5.  **Выравнивание (Alignment):** Запускается многоэтапный процесс сопоставления предложений между двумя текстами на основе косинусной близости их векторов.
6.  **Формирование блоков:** Сопоставленные предложения объединяются в финальные абзацы и блоки для сохранения контекста.
7.  **Сохранение результата:** Все обработанные пары текстов сохраняются в единый `.json` файл с названием, сгенерированным из заголовков книг.
